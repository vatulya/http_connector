<!DOCTYPE html>
<meta charset="utf-8"/>
<title>WebSocket Test</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.dev.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script language="javascript" type="text/javascript">

  $(document).ready(function onReady() {

    var outputContainer = $('#output');
    var queueContainer = $('#index');
    var inputEventName = $('#inputEventName');
    var inputData = $('#inputData');
    var inputSubmit = $('#inputSubmit');
    var inputGetQueue = $('#inputGetQueue');

    function show (message) {
      outputContainer.append('<div>' + message + '</div>');
    }

    function showQueue (index) {
      queueContainer.html('Queue:');
      index.forEach((item) => queueContainer.append('<div>' + item + '</div>'));
    }

    inputSubmit.on('click', function submit () {
      var eventName = inputEventName.val();
      var params = inputData.val().split('\n');
      inputData.val('');

      show('SEND: ' + JSON.stringify(params));

      socket.emit(eventName, ...params);
    });

    inputGetQueue.on('click', function getQueue () {
      socket.emit('getQueue');
    });

    const options = {
        <% if (ws.path) { %>path: '<%= ws.path %>',<% } %>
        transports: ['websocket'],
    };

    const socket = io('<%= ws.host %>', options);

    socket.on('connect', () => {
      show('connected');
    });

    socket.on('message', function (data) {
      show('MESSAGE: ' + JSON.stringify(data));
    });

    socket.on('inQueue', function (data) {
      showQueue(data);
    });

    socket.on('queue', function (data) {
      alert(JSON.stringify(data));
    });

  });

</script>

<body>
<h2>WebSocket Test</h2>

<div>
    <input id="inputEventName" value="message">
    <textarea id="inputData"></textarea>
    <input type="button" id="inputSubmit" value="submit">
    <input type="button" id="inputGetQueue" value="getQueue">
</div>

<div id="output"></div>
<div id="index" style="border: 1px red">:</div>

</body>